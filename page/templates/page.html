{% extends 'base.html' %}
{% load staticfiles %}
{% load imagekit %}
{% block static %}
    <link rel="stylesheet" href="{% static 'page/styles.css' %}">
{% endblock %}
{% block content %}
    <div class="row">
        <div class="col-lg-4 padding">
            <div class="avatar block">
                <div class="image">
                    {% if current_user.settings.avatar %}
                        <img style="width: 200px;cursor: pointer" onclick="location.href='/media/{{ current_user.settings.avatar }}'" src="/media/{{ current_user.settings.avatar }}" alt="">
                    {% endif %}
                </div>
                <div class="buttons">
                    {% if user.id == current_user.id %}
                        <button data-toggle="modal" data-target=".bd-example-modal-md" class="btn btn-outline-success">Новое фото</button>
                    {% else %}
                        {% if current_user in user.settings.friends.all %}
                            true
                        {% elif current_user in user.settings.subscriptions.all %}
                            sub
                        {% else %}
                            <form action="{{ user.get_friends_page_url }}" method="POST">{% csrf_token %}
                                <input hidden name="new-friend" type="text">
                                <input type="text" name="id" hidden value="{{ current_user.id }}">
                                <button type="submit" class="btn btn-outline-primary">Добавить в друзья</button>
                            </form>
                        {% endif %}
                    {% endif %}
                </div>
            </div>
            <div class="friend min-block">
                <h6 style="cursor: pointer; margin-bottom: 15px" onclick="location.href='{{ current_user.get_friends_page_url }}'">Друзья
                    <span style="color: #8e8e8e; padding-left: 5px">{{ friends.count }}</span>
                </h6>
                <div class="list-friend">
                    {% if friends %}
                        {% for friend in friends %}
                            <span onclick="location.href='{{ friend.get_absolute_url }}'">
                            {% thumbnail '55x55' friend.settings.avatar %}
                            <p>{{ friend.get_short_name }}</p>
                        </span>
                        {% endfor %}
                    {% else %}
                        <h6 style="color:darkgray">У вас нет друзей</h6>
                    {% endif %}
                </div>
            </div>
            <div class="friend-online min-block">
                <h6 style="cursor: pointer; margin-bottom: 15px" onclick="location.href='{{ current_user.get_friends_page_url }}?section=online'">Друзья онлайн
                    <span style="color: #8e8e8e; padding-left: 5px">{{ online_friends|length }}</span>
                </h6>
                <div class="list-friend">
                    {% if online_friends %}
                        {% for friend in online_friends %}
                            <span onclick="location.href='{{ friend.get_absolute_url }}'">
                            {% thumbnail '55x55' friend.settings.avatar %}
                            <p>{{ friend.get_short_name }}</p>
                        </span>
                        {% endfor %}
                    {% else %}
                        <h6 style="color:darkgray">Друзей в сети нет</h6>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-lg-8 padding">
            <div class="details block">
                <div>
                    <h5 style="float: left; margin-bottom: 3px">{{ current_user.get_full_name }}</h5>
                    <span style="float: right">{{ current_user.get_last_online }}</span>
                    <div style="clear: left"></div>
                    <div class="status">Создаю социальную сеть</div>
                    <hr>
                </div>
                <div class="short-info">
                    <table class="table table-sm">
                        <tbody>
                        <tr>
                            <td>Место проживания:</td>
                            <th>Москва</th>
                        </tr>
                        <tr>
                            <td>Семейное положение:</td>
                            <th>Женат</th>
                        </tr>
                        <tr>
                            <td>Дата рождения:</td>
                            <th>06.11.1990</th>
                        </tr>
                        <tr>
                            <td>Тип занятости</td>
                            <th>Студент</th>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="photos min-block">
                <div class="header-block">
                    <h6>Фотографии пользователя</h6> <span style="color: #8e8e8e; padding-left: 5px">{{ last_photos.count }}</span>
                    <a href="{{ current_user.get_albums_page_url }}">Показать все</a>
                    <div style="clear: left"></div>
                </div>
                <div class="photos">
                    {% for photo in last_photos|slice:'4' %}
                        <span class="photo">
                            <img style="width: 100px" onclick="location.href='{{ photo.photo.url }}'" src="{{ photo.photo.url }}" alt="">
                        </span>
                    {% endfor %}
                </div>
            </div>
            <div class="wall block">
                <form name="wall" method="POST">{% csrf_token %}
                    <textarea name="wall" class="form-control" placeholder="Что у вас нового?" id="" cols="51" rows="2"></textarea>
                    <div id="button-wall">
                        <hr>
                        <button class="btn btn-outline-info">Отправить</button>
                    </div>
                </form>
            </div>
            {% for writing_wall in current_user.settings.wall.all reversed %}
                <div class="wall min-block">
                    <div style="line-height: 1" class="header">
                        <div style="vertical-align: middle; padding-right: 10px" class="d-inline-block">
                            {% thumbnail '50x50' writing_wall.author.settings.avatar %}
                        </div>
                        <div style="vertical-align: middle" class="d-inline-block">
                            {{ writing_wall.author.get_full_name }}
                            <br>
                            <span style="font-size: 13px; color:darkgray">{{ writing_wall.datetime }}</span>
                        </div>
                    </div>
                    <hr>
                    <div class="content-wall">
                        {{ writing_wall.message }}
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    <div class="modal fade bd-example-modal-md" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                Загрузить новую аватарку
                <hr>
                <form method="POST" enctype="multipart/form-data">{% csrf_token %}
                    <div class="input-group">
                        <span class="input-group-addon" id="basic-addon1"><i class="fas fa-file"></i></span>
                        <input type="file" name="avatar" class="form-control">
                        <input type="text" name="avatar" hidden>
                    </div>
                    <div>
                        <button class="btn btn-outline-success">Готово</button>
                        <button type="button" onclick="$('.modal').modal('hide')" class="btn btn-outline-danger">Отмена</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts %}
    <script src="{% static 'page/scripts.js' %}"></script>
{% endblock %}